from selenium.webdriver.chrome.webdriver import WebDriver
from selenium.webdriver.support.select import Select
import time
from selenium.webdriver.common.keys import Keys
from selenium import webdriver
import pandas as pd
from tabulate import tabulate
import csv
from selenium.webdriver.support.wait import WebDriverWait 


PATH = "C:\Program Files (x86)\chromedriver.exe"



sample = '94521'
zip_codes = [
'94010',
'90242',
'94582',
'94561',
'90007',
'94134',
'92308',
'90275',
'94118',
'95678',
'91387',
'93292',
'95407',
'92802',
'90806',
'90501',
'92545',
'94578',
'92054',
'95132',
'95621',
'94901',
'92591',
'95210',
'90815',
'95695',
'93635',
'92101',
'93637',
'91016',
'94804',
'92253',
'95991',
'95628',
'91311',
'93706',
'90045',
'95404',
'93454',
'90278',
'90605',
'95835',
'91942',
'92231',
'95926',
'90031',
'93552',
'91739',
'91401',
'95129',
'90005',
'92083',
'93619',
'91701',
'92806',
'93534',
'90808',
'92337',
'94534',
'95765',
'90020',
'95301',
'95337',
'92307',
'95826',
'95838',
'94061',
'94044',
'94611',
'90802',
'91763',
'95401',
'92675',
'94954',
'94520',
'95382',
'95050',
'95691',
'91776',
'93021',
'93245',
'94555',
'92508',
'95205',
'92543',
'90301',
'94606',
'92037',
'95120',
'93711',
'90036',
'93305',
'91104',
'91001',
'95928',
'92821',
'91205',
'95121',
'92065',
'95825',
'92831',
'94590',
'95688',
'94588',
'90810',
'90505',
'95993',
'94404',
'95128',
'92869',
'91601',
'93705',
'91711',
'95062',
'95973',
'90029',
'91362',
'95476',
'90012',
'94040',
'95667',
'95820',
'90049',
'91326',
'95126',
'91350',
'91340',
'92139',
'93012',
'94401',
'92883',
'90062',
'93405',
'94603',
'95340',
'95821',
'92706',
'94124',
'91752',
'92807',
'93657',
'90621',
'94952',
'90266',
'95660',
'92660',
'95361',
'92240',
'94583',
'91768',
'93612',
'91780',
'94621',
'94523',
'93561',
'94114',
'92394',
'94063',
'90277',
'91206',
'92131',
'92103',
'92260',
'91722',
'94115',
'91325',
'93955',
'96001',
'92301',
'92672',
'96002',
'91750',
'91007',
'91321',
'92551',
'91773',
'95348',
'93555',
'93060',
'92841',
'92595',
'91754',
'92881',
'92220',
'95842',
'91915',
'93422',
'95901',
'92311',
'93710',
'90504',
'92116',
'91791',
'92373',
'92612',
'90222',
'91423',
'94526',
'95341',
'90606',
'91006',
'91604',
'93703',
'94545',
'91351',
'92583',
'90230',
'92679',
'95356',
'92124',
'91354',
'95358',
'91107',
'92123',
'95118',
'93001',
'92596',
'93940',
'90807',
'95662',
'90803',
'95377',
'90601',
'94941',
'94610',
'91941',
'95632',
'90008',
'91303',
'94589',
'93004',
'95482',
'93618',
'94107',
'94132',
'94102',
'93101',
'95661',
'95131',
'92107',
'90712',
'94801',
'95070',
'94043',
'92203',
'94070',
'94608',
'92173',
'91505',
'91214',
'92673',
'93420',
'95472',
'93662',
'94103',
'91607',
'92120',
'90680',
'91355',
'91316',
'94580',
'94903',
'93654',
'95117',
'95682',
'95824',
'91731',
'94602',
'92405',
'92110',
'95834',
'90302',
'92653',
'95966',
'91356',
'94549',
'90028',
'93704',
'91746',
'91324',
'91792',
'94704',
'92081',
'92694',
'91803',
'94585',
'94131',
'90039',
'95603',
'95212',
'93035',
'95134',
'96150',
'95492',
'95219',
'91384',
'96080',
'90041',
'92604',
'93314',
'93401',
'94518',
'92316',
'95204',
'92262',
'90038',
'95133',
'93105',
'95961',
'94062',
'94510',
'95829',
'90713',
'93901',
'90405',
'93280',
'95370',
'90710',
'91364',
'95363',
'90061',
'94598',
'90017',
'91103',
'94559',
'95618',
'94306',
'90270',
'90035',
'91945',
'93725',
'92227',
'92614',
'95409',
'94002',
'92008',
'90746',
'92868',
'91042',
'90291',
'92629',
'92860',
'94607',
'91755',
'94133',
'91741',
'91504',
'91724',
'91302',
'91932',
'90249',
'90240',
'95242',
'91010',
'91307',
'91301',
'92284',
'92606',
'94530',
'91411',
'91784',
'95032',
'95503',
'90304',
'90064',
'92532',
'94803',
'94123',
'91740',
'94947',
'92832',
'94402',
'95815',
'92411',
'91030',
'94547',
'90602',
'91106',
'95677',
'93933',
'95945',
'94506',
'95003',
'91403',
'91737',
'95367',
'90274',
'92211',
'91775',
'95354',
'92119',
'92651',
'95054',
'90303',
'95215',
'90740',
'93041',
'92011',
'94619',
'92251',
'95746',
'95776',
'90403',
'95531',
'94609',
'94024',
'95969',
'90292',
'92835',
'93212',
'95864',
'92344',
'91202',
'95501',
'93907',
'91201',
'92602',
'96007',
'94085',
'92844',
'92277',
'94597',
'92782',
'90404',
'94089',
'90732',
'95330',
'93610',
'93203',
'90015',
'94030',
'92118',
'92225',
'92108',
'90720',
'93263',
'92354',
'95135',
'95620',
'92663',
'92585',
'94579',
'93560',
'94596',
'94703',
'90272',
'95818',
'92501',
'90603',
'90717',
'90048',
'91101',
'93444',
'95841',
'94706',
'94127',
'90068',
'95405',
'95521',
'95949',
'93630',
'95138',
'95827',
'92865',
'93103',
'94019',
'91501',
'95965',
'92808',
'92377',
'91011',
'94503',
'91361',
'90715',
'90069',
'92106',
'95391',
'96130',
'92264',
'91040',
'94519',
'92887',
'95110',
'93023',
'95819',
'95519',
'90814',
'91602',
'94563',
'92603',
'90254',
'92586',
'94022',
'91381',
'92029',
'90210',
'94564',
'91390',
'91345',
'94945',
'91902',
'93927',
'93268',
'91204',
'92082',
'94949',
'91506',
'91723',
'96161',
'95959',
'93210',
'92371',
'93247',
'92270',
'91901',
'94595',
'93015',
'90265',
'95366',
'90502',
'95602',
'95448',
'91914',
'93111',
'94618',
'92587',
'92582',
'95816',
'92617',
'93930',
'95334',
'94702',
'93110',
'90701',
'90245',
'90670',
'93013',
'95673',
'94301',
'93728',
'93402',
'94556',
'94305',
'94505',
'92610',
'92010',
'93631',
'92845',
'95252',
'96022',
'93250',
'93648',
'92637',
'96021',
'94960',
'91208',
'94612',
'95422',
'90623',
'92866',
'93950',
'95963',
'95203',
'91203',
'95066',
'92274',
'91436',
'94507',
'90305',
'94552',
'95437',
'95650',
'90232',
'94502',
'94542',
'95130',
'94041',
'95315',
'95605',
'93543',
'90716',
'95304',
'95540',
'94805',
'93514',
'94108',
'93221',
'95388',
'95368',
'93723',
'91377',
'93505',
'95817',
'94517',
'92408',
'92014',
'93433',
'94705',
'95030',
'91108',
'90212',
'95360',
'93636',
'94904',
'95490',
'93204',
'93640',
'93923',
'95320',
'93730',
'92075',
'94920',
'90293',
'91105',
'90013',
'92313',
'95742',
'94065',
'93908',
'92625',
'95954',
'90040',
'93301',
'95832',
'93614',
'94709',
'95948',
'95814',
'90402',
'94707',
'95357',
'93646',
'90248',
'95451',
'95640',
'90755',
'92007',
'93647',
'94708',
'92314',
'95453',
'91207',
'95073',
'95425',
'91024',
'95953',
'93442',
'94105',
'95338',
'95012',
'93109',
'93223',
'91502',
'92567',
'94571',
'95386',
'91978',
'95694',
'95064',
'95713',
'93108',
'94572',
'95322',
'93622',
'93219',
'96019',
'93701',
'95326',
'95119',
'93286',
'92310',
'94925',
'90094',
'92657',
'92254',
'96097',
'95006',
'93546',
'95033',
'89060',
'92252',
'93465',
'93926',
'92359',
'93644',
'95946',
'94931',
'93620',
'95010',
'94574',
'92320',
'94930',
'90014',
'92250',
'91020',
'91935',
'95065',
'94158',
'95726',
'90077',
'95324',
'95988',
'93449',
'93625',
'90211',
'92325',
'95327',
'93463',
'94710',
'92249',
'92548',
'92067',
'92241',
'95005',
'93721',
'90056',
'93510',
'95932',
'95220',
'92233',
'94515',
'93434',
'94027',
'95019',
'95139',
'93234',
'93022',
'94028',
'90401',
'93445',
'95642',
'96067',
'95693',
'95316',
'95631',
'95018',
'95658',
'93267',
'92276',
'94939',
'93591',
'92342',
'96094',
'92356',
'93924',
'92624',
'93615',
'93240',
'95683',
'95811',
'95436',
'93427',
'89061',
'92372',
'95202',
'95626',
'95987',
'95971',
'95046',
'93428',
'92861',
'93656',
'95619',
'90290',
'92352',
'95470',
'95467',
'95709',
'95249',
'93256',
'95912',
'93270',
'92363',
'93460',
'95672',
'96101',
'95692',
'92315',
'93609',
'95446',
'95231',
'95666',
'92003',
'92590',
'92210',
'95722',
'95222',
'92278',
'92823',
'96013',
'93501',
'93225',
'95365',
'92121',
'93272',
'94005',
'96088',
'95685',
'94951',
'92397',
'92539',
'95228',
'96064',
'95328',
'93451',
'92382',
'95938',
'91906',
'95614',
'95665',
'93202',
'95004',
'95045',
'93235',
'95236',
'95633',
'95655',
'94129',
'93660',
'93953',
'95247',
'91708',
'95379',
'96073',
'90704',
'94508',
'93675',
'96055',
'95053',
'94304',
'94535',
'90010',
'95627',
'90089',
'95423',
'92140',
'95917',
'95623',
'95237',
'96035',
'95383',
'95258',
'96143',
'96093',
'95634',
'93523',
'95321',
'93602',
'93242',
'95546',
'94038',
'92661',
'95562',
'93437',
'93265',
'93921',
'94525',
'96114',
'96122',
'95982',
'91330',
'96137',
'95457',
'93066',
'95442',
'93650',
'94964',
'95684',
'94599',
'92256',
'92536',
'94130',
'95458',
'90021',
'96041',
'95918',
'95536',
'93430',
'94720',
'93643',
'92365',
'90058',
'92230',
'95951',
'93532',
'95223',
'92061',
'96032',
'95485',
'92275',
'92036',
'92281',
'93616',
'95428',
'93453',
'95329',
'95461',
'97623',
'95333',
'92662',
'92549',
'95460',
'95464',
'94037',
'95663',
'93252',
'93271',
'93285',
'93261',
'92285',
'90067',
'93626',
'93667',
'96020',
'95002',
'95570',
'96027',
'95669',
'92004',
'93283',
'95445',
'92386',
'93516',
'95690',
'92398',
'94511',
'89019',
'96145',
'96025',
'95454',
'91962',
'93925',
'92676',
'96134',
'95372',
'93205',
'92273',
'92391',
'93258',
'91916',
'96113',
'95469',
'95311',
'92145',
'95645',
'95975',
'93249',
'95310',
'95542',
'90263',
'93040',
'93545',
'95421',
'95567',
'93651',
'95441',
'96118',
'93562',
'95319',
'95245',
'93553',
'93206',
'95689',
'94020',
'92283',
'95374',
'93601',
'95524',
'93440',
'95947',
'95903',
'95211',
'93513',
'95560',
'95664',
'93222',
'93201',
'96052',
'97632',
'95573',
'95449',
'93527',
'93920',
'92086',
'95937',
'93243',
'96056',
'93432',
'95641',
'95977',
'94514',
'91905',
'92059',
'92561',
'95528',
'96107',
'95389',
'95551',
'96103',
'95415',
'95955',
'93653',
'92282',
'96028',
'95916',
'96051',
'95426',
'93461',
'93266',
'95962',
'95612',
'92091',
'92242',
'95313',
'95323',
'95255',
'89439',
'92257',
'95468',
'97633',
'95686',
'95548',
'95681',
'96057',
'95968',
'94973',
'94957',
'95317',
'95636',
'96008',
'96023',
'91963',
'94575',
'93544',
'95246',
'94956',
'96146',
'95497',
'94924',
'95462',
'95303',
'91008',
'92339',
'94922',
'95039',
'95547',
'95635',
'92321',
'93606',
'95369',
'92518',
'92368',
'95410',
'91917',
'95466',
'95919',
'95589',
'90073',
'94592',
'95629',
'95942',
'95659',
'95549',
'94060',
'93441',
'94938',
'95452',
'95701',
'96039',
'96142',
'95957',
'95943',
'93666',
'94613',
'93928',
'96047',
'96024',
'96104',
'95230',
'95456',
'94933',
'94586',
'93518',
'96109',
'94923',
'95345',
'96069',
'93424',
'95652',
'93254',
'95941',
'93450',
'95565',
'93673',
'93665',
'95552',
'94937',
'92327',
'95830',
'96038',
'95043',
'96048',
'95439',
'92358',
'93932',
'95432',
'95444',
'95615',
'96096',
'92347',
'94970',
'92066',
'90742',
'93255',
'96128',
'95960',
'95017',
'93238',
'92322',
'95563',
'95668',
'93452',
'92305',
'95306',
'93517',
'95387',
'92135',
'93526',
'95251',
'95651',
'96091',
'95970',
'91931',
'95939',
'95556',
'92678',
'95653',
'96148',
'95471',
'92309',
'95675',
'92258',
'96058',
'93954',
'95233',
'96087',
'96059',
'93604',
'93652',
'96084',
'91210',
'95420',
'95714',
'92147',
'89010',
'94021',
'95554',
'95527',
'96033',
'96090',
'93224',
'95075',
'96124',
'95585',
'92155',
'92268',
'92328',
'95555',
'95041',
'94104',
'96016',
'95558',
'95385',
'93962',
'93067',
'96129',
'95257',
'94963',
'96141',
'95412',
'92333',
'93529',
'96006',
'94528',
'96050',
'95983',
'95225',
'95493',
'95007',
'96105',
'95569',
'96063',
'96121',
'93563',
'95417',
'96117',
'95950',
'95956',
'96092',
'93531',
'95639',
'93512',
'95984',
'91934',
'96009',
'96015',
'96054',
'95920',
'93244',
'91759',
'95571',
'96135',
'95837',
'95435',
'93549',
'95736',
'94940',
'92134',
'96076',
'96034',
'96086',
'95925',
'96106',
'95637',
'95511',
'95935',
'93207',
'94929',
'95537',
'95606',
'93627',
'95978',
'93541',
'93669',
'90743',
'92378',
'95728',
'95450',
'93260',
'96112',
'93641',
'92341',
'95318',
'92385',
'96068',
'93251',
'96011',
'93605',
'95526',
'95443',
'95697',
'94569',
'95488',
'95717',
'93603',
'96116',
'95494',
'94074',
'92389',
'95224',
'92060',
'93524',
'96074',
'95431',
'95936',
'95335',
'95601',
'95698',
'94128',
'93429',
'95514',
'95595',
'95463',
'96014',
'90822',
'91948',
'96110',
'93554',
'96040',
'95910',
'96010',
'92259',
'93528',
'95545',
'95429',
'93592',
'93623',
'92266',
'95248',
'94576',
'95715',
'95720',
'95140',
'93522',
'92332',
'95314',
'95550',
'96049',
'96126',
'93628',
'95646',
'95325',
'95625',
'95930',
'95559',
'93220',
'96119',
'95679',
'96085',
'93262',
'95486',
'96132',
'96136',
'95981',
'94573',
'96071',
'95923',
'93558',
'96123',
'92304',
'93634',
'96061',
'92384',
'94512',
'95735',
'93530',
'95430',
'92267',
'95375']

titles = []
prices = []
mileage = []
car_year = []
car_make = []
car_zipcode = []

missed_zips = []

driver = webdriver.Chrome(PATH)

for code in zip_codes:
   
    driver.get("https://www.cars.com/")
    wait = WebDriverWait(driver, 2)
    time.sleep(1)

    if driver.find_element_by_xpath('//*[@id="make-model-zip"]') != None:

        driver.find_element_by_xpath('//*[@id="make-model-zip"]').clear()
        driver.find_element_by_xpath('//*[@id="make-model-zip"]').send_keys(code)

        used_dropdown = Select(driver.find_element_by_xpath('//*[@id="make-model-search-stocktype"]'))
        used_dropdown.select_by_index(3)

        make_dropdown = Select(driver.find_element_by_xpath('//*[@id="makes"]'))
        make_dropdown.select_by_index(0)

        model_dropdown = Select(driver.find_element_by_xpath('//*[@id="models"]'))
        model_dropdown.select_by_index(0)

        price_dropdown = Select(driver.find_element_by_xpath('//*[@id="make-model-max-price"]'))
        price_dropdown.select_by_index(0)

        distance_dropdown = Select(driver.find_element_by_xpath('//*[@id="make-model-maximum-distance"]'))
        distance_dropdown.select_by_index(2)

        driver.find_element_by_xpath('//*[@id="by-make-tab"]/div/div[7]/button').click()
        time.sleep(1)

        

        for i in range(10):
            
            all_titles = driver.find_elements_by_class_name('title')
            all_prices = driver.find_elements_by_class_name('primary-price')
            all_mileage = driver.find_elements_by_class_name('mileage')
            time.sleep(1)
            if all_titles != None:

                for index,title in enumerate(all_titles):
                    titles.append(title.text.split(" ", 1))
                    car_year.append(titles[index][0])
                    car_make.append(titles[index][1])

                for price in all_prices:
                    prices.append(price.text)
                    car_zipcode.append(code)    

                for miles in all_mileage:
                    mileage.append(miles.text)
                driver.find_element_by_xpath('//*[@id="next_paginate"]').click()
                time.sleep(1)
            else:
                missed_zips.append(code)
                time.sleep(1)
                pass

        with open('dataFrameSafety.txt', 'w') as f:
            f.write('===========================================')
            writer = csv.writer(f, delimiter='\t')
            writer.writerows(zip(car_make, car_year, prices, mileage, car_zipcode))
            f.write('===========================================')

        #print('=============================================')    
        #print(car_zipcode)
        #print('============================================')
    else:
        missed_zips.append(code)
        time.sleep(1)
        pass
    

df = pd.DataFrame({'Make_Model': car_make, 'Year': car_year, 'Price': prices, 'Miles': mileage, 'Zip_Code': car_zipcode})
df.index += 1 

df_file = open('dataframe.txt', 'a')
df_file.write(df.to_string)
df_file.close()

missing_zips = open('missed_zips.txt', 'a')
missing_zips.write(missed_zips)
missing_zips.close()

